# ===================================================================
# Ingress: 외부 트래픽을 내부 서비스로 라우팅
# ===================================================================
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: portal-universe-ingress
  namespace: portal-universe
  annotations:
    # NGINX Ingress Controller를 사용하기 위한 설정들입니다.
    nginx.ingress.kubernetes.io/ssl-redirect: "false" # HTTPS로 강제 리다이렉트하지 않음 (로컬 환경)
spec:
  # 이 Ingress 리소스가 사용할 IngressClass의 이름입니다.
  # ingress-controller.yaml에 정의된 'nginx' IngressClass를 사용합니다.
  ingressClassName: nginx
  rules:
    # 'portal-universe'라는 호스트 이름으로 들어오는 요청에 대한 규칙입니다.
    # 로컬에서 /etc/hosts 파일에 '127.0.0.1 portal-universe'를 추가하여 사용할 수 있습니다.
    - host: portal-universe
      http:
        paths:
          # --- 모니터링 서비스 라우팅 ---
          # /grafana 경로로 들어오는 모든 요청은 grafana 서비스의 3000 포트로 전달됩니다.
          - path: /grafana
            pathType: Prefix
            backend:
              service:
                name: grafana
                port:
                  number: 3000

          # /prometheus 경로로 들어오는 모든 요청은 prometheus 서비스의 9090 포트로 전달됩니다.
          - path: /prometheus
            pathType: Prefix
            backend:
              service:
                name: prometheus
                port:
                  number: 9090

          # /zipkin 경로로 들어오는 모든 요청은 zipkin 서비스의 9411 포트로 전달됩니다.
          - path: /zipkin
            pathType: Prefix
            backend:
              service:
                name: zipkin
                port:
                  number: 9411

          # --- API 서비스 라우팅 ---
          # /auth-service/** 경로로 들어오는 모든 요청은 api-gateway 서비스의 8080 포트로 전달됩니다.
          - path: /auth-service
            pathType: Prefix
            backend:
              service:
                name: api-gateway
                port:
                  number: 8080

          # /api/** 경로로 들어오는 모든 요청은 api-gateway 서비스의 8080 포트로 전달됩니다.
          - path: /api
            pathType: Prefix
            backend:
              service:
                name: api-gateway
                port:
                  number: 8080

          # --- 기본 라우팅 ---
          # 위 규칙에 해당하지 않는 모든 요청(루트 경로 등)은 portal-shell 서비스의 80 포트로 전달됩니다.
          - path: /
            pathType: Prefix
            backend:
              service:
                name: portal-shell
                port:
                  number: 80

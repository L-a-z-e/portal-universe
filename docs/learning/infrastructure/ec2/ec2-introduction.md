# Amazon EC2 소개

## 학습 목표
- EC2의 핵심 개념과 가상 서버 이해
- 인스턴스 타입 체계와 선택 기준 학습
- AMI, 보안 그룹, 키 페어 등 핵심 구성 요소 파악
- EBS 스토리지와 인스턴스의 관계 이해
- Portal Universe에서 Kubernetes를 선택한 배경 이해

---

## 1. EC2란?

Amazon EC2(Elastic Compute Cloud)는 **클라우드 기반 가상 서버**입니다. 물리 서버를 구매하지 않고도 원하는 사양의 서버를 몇 분 만에 생성할 수 있습니다.

### 핵심 특징

| 특성 | 설명 |
|------|------|
| **탄력성 (Elastic)** | 필요에 따라 서버를 추가/제거 가능 |
| **종량 과금** | 사용한 시간만큼만 비용 지불 (초 단위) |
| **다양한 사양** | CPU, 메모리, 네트워크 최적화 옵션 |
| **글로벌 배포** | 전 세계 리전에서 서버 생성 가능 |
| **자동화** | API를 통한 서버 생성/삭제 자동화 |

### 전통 서버 vs EC2

```
[전통 서버 (온프레미스)]
- 물리 서버 구매 (초기 비용 큼)
- 설치까지 수주~수개월
- 용량 변경 어려움
- 하드웨어 유지보수 필요
- 고정 비용

[EC2 (클라우드)]
- 가상 서버 대여 (초기 비용 없음)
- 몇 분 내 생성 완료
- 언제든 사양 변경 가능
- AWS가 하드웨어 관리
- 사용한 만큼만 비용
```

---

## 2. 인스턴스 타입 체계

EC2는 **워크로드에 따라 최적화된 인스턴스 타입**을 제공합니다.

### 2.1 인스턴스 타입 네이밍 규칙

```
예시: m5.xlarge
      │└┘ └───┘
      │ │   └─── 크기 (xlarge)
      │ └─────── 세대 (5세대)
      └───────── 패밀리 (범용 - m)
```

### 2.2 주요 인스턴스 패밀리

| 패밀리 | 유형 | 용도 | 예시 타입 | 사용 사례 |
|--------|------|------|-----------|-----------|
| **t** | 범용 (버스트 가능) | 개발/테스트 환경 | t2.micro, t3.medium | 웹 서버, 소규모 DB |
| **m** | 범용 (균형 잡힌) | 일반 애플리케이션 | m5.large, m6i.xlarge | API 서버, 백엔드 |
| **c** | 컴퓨팅 최적화 | CPU 집약적 작업 | c5.large, c6g.xlarge | 배치 처리, 인코딩 |
| **r** | 메모리 최적화 | RAM 집약적 작업 | r5.large, r6i.xlarge | 인메모리 DB, 캐시 |
| **x** | 메모리 최적화 (초고용량) | 대용량 메모리 | x1e.xlarge | SAP HANA, 대용량 DB |
| **i** | 스토리지 최적화 | 고성능 I/O | i3.large, i4i.xlarge | NoSQL DB, 데이터 웨어하우스 |
| **d** | 스토리지 최적화 (밀집) | 대용량 디스크 | d2.xlarge | 하둡, 로그 처리 |

### 2.3 인스턴스 크기

```
nano    < micro < small < medium < large < xlarge < 2xlarge < 4xlarge ...
└─────────────── 작음 ────────────┴────────────── 큼 ─────────────────┘

예시 (vCPU / Memory):
t3.nano:    2 vCPU /  0.5 GB
t3.micro:   2 vCPU /  1 GB
t3.small:   2 vCPU /  2 GB
t3.medium:  2 vCPU /  4 GB
t3.large:   2 vCPU /  8 GB
t3.xlarge:  4 vCPU / 16 GB
t3.2xlarge: 8 vCPU / 32 GB
```

### 2.4 T 시리즈의 버스트 (Burstable) 개념

```
T 시리즈는 "CPU 크레딧" 방식으로 작동:

[정상 상태]
CPU 사용률 낮음 → 크레딧 축적

[버스트 상태]
트래픽 급증 → 축적한 크레딧 소비하여 CPU 성능 향상

⚠️ 크레딧 소진 시 기본 성능으로 제한됨
→ 지속적 고부하 작업에는 m, c 시리즈 권장
```

---

## 3. AMI (Amazon Machine Image)

EC2 인스턴스를 시작하기 위한 **템플릿**입니다.

### 3.1 AMI 구성 요소

```
┌──────────────────────────────────────────┐
│            AMI                            │
├──────────────────────────────────────────┤
│ 1. 운영 체제 (OS)                         │
│    - Amazon Linux 2023                   │
│    - Ubuntu 22.04                        │
│    - Windows Server 2022                 │
│                                          │
│ 2. 애플리케이션 서버                      │
│    - Apache, Nginx                       │
│    - Node.js, Java 런타임                │
│                                          │
│ 3. 사전 구성                              │
│    - 방화벽 설정                          │
│    - 모니터링 에이전트                    │
│                                          │
│ 4. 루트 볼륨 스냅샷                       │
└──────────────────────────────────────────┘
```

### 3.2 AMI 타입

| 타입 | 설명 | 비용 |
|------|------|------|
| **AWS 제공 AMI** | Amazon Linux, Ubuntu 등 | 무료 (인스턴스 비용만) |
| **마켓플레이스 AMI** | 3rd party 소프트웨어 포함 | 라이선스 비용 발생 가능 |
| **커뮤니티 AMI** | 사용자가 공유한 AMI | 무료 (검증 필요) |
| **나만의 AMI** | 기존 인스턴스로부터 생성 | 스토리지 비용 |

### 3.3 커스텀 AMI 생성

```
┌──────────────────────────────────────────┐
│ Step 1: 베이스 인스턴스 생성               │
│  - Amazon Linux 2023 선택                │
│  - 필요한 소프트웨어 설치                 │
│    (Java, Docker, 애플리케이션)           │
│  - 구성 완료                              │
└──────────────┬───────────────────────────┘
               │
               ▼
┌──────────────────────────────────────────┐
│ Step 2: AMI 생성 (Create Image)          │
│  - 인스턴스 → Actions → Create Image      │
│  - 현재 상태를 스냅샷으로 저장             │
└──────────────┬───────────────────────────┘
               │
               ▼
┌──────────────────────────────────────────┐
│ Step 3: 새 인스턴스 생성                  │
│  - 내 AMI에서 선택                        │
│  - 사전 구성된 환경 즉시 사용 가능        │
└──────────────────────────────────────────┘
```

**Portal Universe 사용 예시:**
```bash
# 베이스 AMI: Amazon Linux 2023
# 사전 설치: Docker, kubectl, Java 17
# 목적: CI/CD 빌드 서버용 AMI
```

---

## 4. 보안 그룹 (Security Group)

EC2 인스턴스의 **가상 방화벽**입니다.

### 4.1 보안 그룹 동작 방식

```
인터넷                      보안 그룹                  EC2 인스턴스
   │                           │                          │
   │ HTTP (80)                 │                          │
   ├───────────────────────────► 허용 (Inbound 규칙)     │
   │                           ├──────────────────────────►
   │                           │                          │
   │ SSH (22)                  │                          │
   ├───────────────────────────► 허용 (특정 IP만)        │
   │                           ├──────────────────────────►
   │                           │                          │
   │ RDP (3389)                │                          │
   ├───────────────────────────X 차단 (규칙 없음)        │
   │                           │                          │
```

### 4.2 규칙 구조

```yaml
보안 그룹: web-server-sg

Inbound Rules:
  - Type: HTTP
    Protocol: TCP
    Port: 80
    Source: 0.0.0.0/0  # 모든 IP 허용

  - Type: HTTPS
    Protocol: TCP
    Port: 443
    Source: 0.0.0.0/0

  - Type: SSH
    Protocol: TCP
    Port: 22
    Source: 203.0.113.0/24  # 특정 IP 대역만 허용

Outbound Rules:
  - Type: All Traffic
    Protocol: All
    Port: All
    Destination: 0.0.0.0/0  # 기본: 모든 아웃바운드 허용
```

### 4.3 보안 그룹 특징

| 특징 | 설명 |
|------|------|
| **상태 유지 (Stateful)** | 허용된 인바운드 트래픽의 응답은 자동 허용 |
| **거부 규칙 없음** | 명시적 허용만 가능 (기본은 모두 차단) |
| **여러 그룹 적용 가능** | 하나의 인스턴스에 최대 5개 |
| **즉시 적용** | 규칙 변경 시 재시작 불필요 |

**Portal Universe 예시:**
```yaml
# Kubernetes 노드 보안 그룹
k8s-node-sg:
  Inbound:
    - Port: 22 (SSH from bastion)
    - Port: 10250 (kubelet)
    - Port: 30000-32767 (NodePort services)
```

---

## 5. 키 페어 (Key Pair)

EC2 인스턴스에 **안전하게 접속**하기 위한 SSH 키입니다.

### 5.1 키 페어 생성 및 사용

```
┌──────────────────────────────────────────┐
│ Step 1: AWS에서 키 페어 생성              │
│  - EC2 Console → Key Pairs → Create      │
│  - 이름: my-key                           │
└──────────────┬───────────────────────────┘
               │
               ▼
┌──────────────────────────────────────────┐
│ Step 2: 프라이빗 키 다운로드              │
│  - my-key.pem 파일 저장                   │
│  - ⚠️ 한 번만 다운로드 가능!              │
└──────────────┬───────────────────────────┘
               │
               ▼
┌──────────────────────────────────────────┐
│ Step 3: 권한 설정                         │
│  $ chmod 400 my-key.pem                  │
└──────────────┬───────────────────────────┘
               │
               ▼
┌──────────────────────────────────────────┐
│ Step 4: SSH 접속                          │
│  $ ssh -i my-key.pem ec2-user@<public-ip>│
└──────────────────────────────────────────┘
```

### 5.2 보안 주의사항

```
✅ 좋은 관행:
- 프라이빗 키를 안전한 곳에 보관 (암호화된 볼륨)
- 팀원마다 별도의 키 페어 생성
- 주기적으로 키 로테이션
- 키 파일 권한을 400으로 제한

❌ 나쁜 관행:
- 키를 Git에 커밋
- 키를 이메일로 전송
- 여러 명이 같은 키 공유
- 프라이빗 키를 퍼블릭 클라우드 스토리지에 저장
```

---

## 6. EBS (Elastic Block Store)

EC2 인스턴스에 연결되는 **블록 수준 스토리지**입니다.

### 6.1 EBS vs 인스턴스 스토어

| 특성 | EBS | 인스턴스 스토어 |
|------|-----|-----------------|
| **영속성** | 인스턴스 종료 후에도 유지 | 인스턴스 종료 시 삭제 |
| **백업** | 스냅샷 지원 | 지원 안 함 |
| **크기 조정** | 온라인으로 확장 가능 | 고정 |
| **성능** | 네트워크 기반 (안정적) | 물리 디스크 (매우 빠름) |
| **용도** | 운영 DB, 시스템 볼륨 | 임시 데이터, 캐시 |

### 6.2 EBS 볼륨 타입

| 타입 | IOPS | 처리량 | 용도 | 비용 |
|------|------|--------|------|------|
| **gp3** (범용 SSD) | 3,000-16,000 | 125-1,000 MB/s | 대부분의 워크로드 | 낮음 |
| **gp2** (범용 SSD) | 100-16,000 | 최대 250 MB/s | 이전 세대 | 낮음 |
| **io2** (프로비저닝 IOPS) | 최대 64,000 | 최대 1,000 MB/s | 고성능 DB | 높음 |
| **st1** (처리량 최적화 HDD) | - | 최대 500 MB/s | 빅데이터, 로그 | 매우 낮음 |
| **sc1** (콜드 HDD) | - | 최대 250 MB/s | 아카이브 | 최저 |

### 6.3 EBS 스냅샷

```
┌──────────────────────────────────────────┐
│ 원본 EBS 볼륨 (100GB)                     │
│  ├─ OS 파일                               │
│  ├─ 애플리케이션 데이터                    │
│  └─ 로그 파일                             │
└──────────────┬───────────────────────────┘
               │ 스냅샷 생성
               ▼
┌──────────────────────────────────────────┐
│ EBS 스냅샷 (S3에 저장)                    │
│  - 증분 백업 (변경분만 저장)              │
│  - 다른 리전으로 복사 가능                │
│  - 새 볼륨 생성에 사용 가능               │
└──────────────────────────────────────────┘
```

---

## 7. LocalStack에서의 EC2 제한

Portal Universe는 로컬 개발에 **LocalStack**을 사용하지만, EC2 에뮬레이션은 **제한적**입니다.

### 7.1 LocalStack EC2 지원 범위

```
✅ 지원되는 기능:
- 기본 API 호출 에뮬레이션
- 인스턴스 메타데이터 시뮬레이션
- 보안 그룹 API

❌ 지원 안 되는 기능:
- 실제 가상 머신 생성
- 실제 네트워크 격리
- 실제 EBS 볼륨

💡 대안: Docker Compose로 직접 컨테이너 관리
```

### 7.2 Portal Universe의 선택

```
EC2 대신 Kubernetes를 선택한 이유:

1. 컨테이너 네이티브:
   - 마이크로서비스 아키텍처에 최적화
   - 빌드-배포 자동화

2. 로컬 개발:
   - Kind (Kubernetes in Docker)로 로컬 클러스터
   - EC2 없이도 동일한 환경

3. 클라우드 독립성:
   - AWS, GCP, Azure 모두 지원
   - 온프레미스 배포 가능

4. 스케일링:
   - 수평 확장 자동화 (HPA)
   - 로드 밸런싱 내장
```

---

## 8. Portal Universe에서의 EC2 역할

### 8.1 Kubernetes 노드로 사용

```
┌──────────────────────────────────────────────────┐
│              EKS Cluster (AWS)                    │
├──────────────────────────────────────────────────┤
│  ┌────────────────┐  ┌────────────────┐         │
│  │ EC2 노드 1     │  │ EC2 노드 2     │         │
│  │ (m5.large)     │  │ (m5.large)     │         │
│  │                │  │                │         │
│  │ ┌──────────┐  │  │ ┌──────────┐  │         │
│  │ │ Pod 1    │  │  │ │ Pod 3    │  │         │
│  │ │ Pod 2    │  │  │ │ Pod 4    │  │         │
│  │ └──────────┘  │  │ └──────────┘  │         │
│  └────────────────┘  └────────────────┘         │
└──────────────────────────────────────────────────┘

📌 EKS는 관리형 Kubernetes로, 워커 노드로 EC2를 사용
📌 Fargate를 사용하면 EC2 관리 불필요 (서버리스)
```

### 8.2 로컬 vs 프로덕션

| 환경 | 인프라 | 설명 |
|------|--------|------|
| **로컬** | Kind (Docker) | 개발자 노트북에서 실행 |
| **프로덕션** | EKS (EC2 노드) | AWS에서 EC2 기반 클러스터 |

---

## 9. 핵심 정리

| 개념 | 설명 |
|------|------|
| **EC2** | 클라우드 기반 가상 서버 (탄력적, 종량 과금) |
| **인스턴스 타입** | 워크로드에 따른 최적화 (t: 범용, c: CPU, r: 메모리) |
| **AMI** | 인스턴스 시작 템플릿 (OS + 애플리케이션) |
| **보안 그룹** | 가상 방화벽 (Stateful, 허용 규칙만) |
| **키 페어** | SSH 접속용 인증 키 |
| **EBS** | 영속적 블록 스토리지 (스냅샷 지원) |

---

## 다음 학습

- [EC2 vs Kubernetes](./ec2-vs-kubernetes.md) - 컨테이너 오케스트레이션 비교
- [EKS 소개](../eks/eks-introduction.md) - 관리형 Kubernetes 서비스
- [IAM 권한 설정](../iam/iam-introduction.md) - EC2 인스턴스 역할

---

## 참고 자료

- [AWS EC2 공식 문서](https://docs.aws.amazon.com/ec2/)
- [EC2 인스턴스 타입](https://aws.amazon.com/ec2/instance-types/)
- [LocalStack EC2](https://docs.localstack.cloud/user-guide/aws/ec2/)

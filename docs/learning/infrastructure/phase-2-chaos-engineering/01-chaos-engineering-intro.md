# Chaos Engineering ì†Œê°œ

Chaos Engineeringì˜ ì›ì¹™ê³¼ ë°©ë²•ë¡ ì„ í•™ìŠµí•©ë‹ˆë‹¤.

---

## í•™ìŠµ ëª©í‘œ

- [ ] Chaos Engineeringì˜ ì •ì˜ì™€ ëª©ì ì„ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤
- [ ] í•µì‹¬ ì›ì¹™ì„ ì´í•´í•˜ê³  ì ìš©í•  ìˆ˜ ìˆë‹¤
- [ ] ì•ˆì „í•œ ì‹¤í—˜ í™˜ê²½ì„ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤

---

## 1. Chaos Engineeringì´ë€?

### ì •ì˜

> "Chaos Engineering is the discipline of experimenting on a system in order to build confidence in the system's capability to withstand turbulent conditions in production."
>
> â€” Netflix, Principles of Chaos Engineering

**ë²ˆì—­**: í”„ë¡œë•ì…˜ì˜ í˜¼ë€ìŠ¤ëŸ¬ìš´ ìƒí™©ì„ ê²¬ë”œ ìˆ˜ ìˆë‹¤ëŠ” **í™•ì‹ **ì„ ì–»ê¸° ìœ„í•´ ì‹œìŠ¤í…œì— **ì‹¤í—˜**í•˜ëŠ” ë¶„ì•¼

### ì™œ í•„ìš”í•œê°€?

**ê¸°ì¡´ í…ŒìŠ¤íŠ¸ì˜ í•œê³„**:
- ë‹¨ìœ„ í…ŒìŠ¤íŠ¸: ì½”ë“œ ë¡œì§ ê²€ì¦
- í†µí•© í…ŒìŠ¤íŠ¸: ì»´í¬ë„ŒíŠ¸ ê°„ ì—°ë™ ê²€ì¦
- ë¶€í•˜ í…ŒìŠ¤íŠ¸: ì„±ëŠ¥ í•œê³„ ê²€ì¦

**ê²€ì¦í•˜ì§€ ëª»í•˜ëŠ” ê²ƒ**:
- "Kafkaê°€ ë‹¤ìš´ë˜ë©´ ì–´ë–»ê²Œ ë˜ì§€?"
- "ë„¤íŠ¸ì›Œí¬ ì§€ì—°ì´ 5ì´ˆ ë°œìƒí•˜ë©´?"
- "Redis ë©”ëª¨ë¦¬ê°€ ê°€ë“ ì°¨ë©´?"

**Chaos Engineering**:
- ì‹¤ì œ ì¥ì•  ìƒí™©ì„ **í†µì œëœ ë°©ì‹**ìœ¼ë¡œ ì¬í˜„
- **ì˜ˆìƒëŒ€ë¡œ ë™ì‘í•˜ëŠ”ì§€** ê²€ì¦
- ì¥ì•  **ëŒ€ì‘ ëŠ¥ë ¥** í–¥ìƒ

---

## 2. Chaos Engineering vs ê¸°ì¡´ í…ŒìŠ¤íŠ¸

| íŠ¹ì„± | ê¸°ì¡´ í…ŒìŠ¤íŠ¸ | Chaos Engineering |
|------|------------|-------------------|
| **ëª©ì ** | ë²„ê·¸ ë°œê²¬ | ì‹œìŠ¤í…œ ì´í•´ |
| **ëŒ€ìƒ** | ì½”ë“œ/ê¸°ëŠ¥ | ì‹œìŠ¤í…œ ì „ì²´ |
| **í™˜ê²½** | ê°œë°œ/ìŠ¤í…Œì´ì§• | ìŠ¤í…Œì´ì§•/í”„ë¡œë•ì…˜ |
| **ê²°ê³¼** | Pass/Fail | í•™ìŠµ/ê°œì„  |
| **ê´€ì ** | "ì‘ë™í•˜ëŠ”ê°€?" | "ì–´ë–»ê²Œ ì‹¤íŒ¨í•˜ëŠ”ê°€?" |

---

## 3. Chaos Engineering ì›ì¹™

### ì›ì¹™ 1: ì •ìƒ ìƒíƒœ ê°€ì„¤ ìˆ˜ë¦½ (Steady State Hypothesis)

**ì •ì˜**: "ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ” ìƒíƒœ"ë¥¼ ì •ëŸ‰ì ìœ¼ë¡œ ì •ì˜

```yaml
# ì˜ˆì‹œ: Portal Universe ì •ìƒ ìƒíƒœ
steady_state:
  - metric: "ìš”ì²­ ì„±ê³µë¥ "
    threshold: ">= 99%"

  - metric: "p99 ì‘ë‹µ ì‹œê°„"
    threshold: "<= 500ms"

  - metric: "í™œì„± Pod ìˆ˜"
    threshold: ">= 1 per service"
```

### ì›ì¹™ 2: ì‹¤ì œ ì´ë²¤íŠ¸ ë°˜ì˜

**ì‹¤ì œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì´ë²¤íŠ¸**:
- ì„œë²„ ë‹¤ìš´ (í•˜ë“œì›¨ì–´ ì¥ì• )
- ë„¤íŠ¸ì›Œí¬ ì§€ì—° (í˜¼ì¡)
- ë””ìŠ¤í¬ í’€ (ë¡œê·¸ ì¦ê°€)
- ë©”ëª¨ë¦¬ ë¶€ì¡± (ë©”ëª¨ë¦¬ ëˆ„ìˆ˜)
- ì˜ì¡´ ì„œë¹„ìŠ¤ ì¥ì•  (ì™¸ë¶€ API)

**ê°€ìƒì˜ ì‹œë‚˜ë¦¬ì˜¤ê°€ ì•„ë‹˜**:
```
âŒ "CPUê°€ 1000% ë˜ë©´?" (ë¶ˆê°€ëŠ¥)
âŒ "ëª¨ë“  ì„œë²„ê°€ ë™ì‹œì— í­ë°œí•˜ë©´?" (ê·¹íˆ ë“œë¬¸)
âœ… "ë‹¨ì¼ Podê°€ OOMìœ¼ë¡œ ì£½ìœ¼ë©´?" (í”í•¨)
âœ… "ë„¤íŠ¸ì›Œí¬ ì§€ì—°ì´ 100ms ì¦ê°€í•˜ë©´?" (í”í•¨)
```

### ì›ì¹™ 3: í”„ë¡œë•ì…˜(ì— ê°€ê¹Œìš´) í™˜ê²½ì—ì„œ ì‹¤í—˜

| í™˜ê²½ | ì í•©ë„ | ì´ìœ  |
|------|--------|------|
| ê°œë°œ | ğŸŸ¡ | ì‹¤ì œ ë¶€í•˜/ë°ì´í„° ì—†ìŒ |
| ìŠ¤í…Œì´ì§• | ğŸŸ¢ | í”„ë¡œë•ì…˜ ìœ ì‚¬, ì•ˆì „ |
| í”„ë¡œë•ì…˜ | ğŸ”´ | ê°€ì¥ ì •í™•, ìœ„í—˜ |

**Portal Universe ê¶Œì¥**: **ìŠ¤í…Œì´ì§•** ë˜ëŠ” **ë¡œì»¬ Kind í´ëŸ¬ìŠ¤í„°**

### ì›ì¹™ 4: ìë™í™” ë° ì§€ì† ì‹¤í–‰

```yaml
# CI/CDì— í†µí•©
pipeline:
  - build
  - unit-test
  - integration-test
  - deploy-staging
  - chaos-experiment  # â† ìë™ ì‹¤í–‰
  - deploy-production
```

### ì›ì¹™ 5: ì˜í–¥ ë²”ìœ„ ìµœì†Œí™”

```yaml
experiment:
  # Blast Radius ì œí•œ
  scope:
    namespace: "portal-universe"
    deployment: "auth-service"
    replicas_affected: 1  # ì „ì²´ê°€ ì•„ë‹Œ ì¼ë¶€

  # ìë™ ë¡¤ë°±
  rollback:
    on_failure: true
    timeout: 5m
```

---

## 4. Chaos Engineering í”„ë¡œì„¸ìŠ¤

### ë‹¨ê³„ë³„ í”„ë¡œì„¸ìŠ¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ì •ìƒ ìƒíƒœ ì •ì˜ (Steady State)                           â”‚
â”‚     - SLO ê¸°ë°˜ ì§€í‘œ ì„ ì •                                    â”‚
â”‚     - ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ ì¤€ë¹„                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. ê°€ì„¤ ìˆ˜ë¦½ (Hypothesis)                                  â”‚
â”‚     - "X ì¥ì•  ì‹œ Yê°€ ë°œìƒí•  ê²ƒì´ë‹¤"                         â”‚
â”‚     - ì˜ˆ: "Kafka ë‹¤ìš´ ì‹œ Circuit Breakerê°€ ì—´ë¦´ ê²ƒì´ë‹¤"     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. ì‹¤í—˜ ì„¤ê³„ (Design)                                      â”‚
â”‚     - ì¥ì•  ì£¼ì… ë°©ë²• ê²°ì •                                   â”‚
â”‚     - ì˜í–¥ ë²”ìœ„ ì œí•œ                                        â”‚
â”‚     - ë¡¤ë°± ê³„íš ìˆ˜ë¦½                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. ì‹¤í—˜ ì‹¤í–‰ (Execute)                                     â”‚
â”‚     - ì‚¬ì „ ì¡°ê±´ í™•ì¸                                        â”‚
â”‚     - ì¥ì•  ì£¼ì…                                             â”‚
â”‚     - ì‹¤ì‹œê°„ ê´€ì°°                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. ë¶„ì„ (Analyze)                                          â”‚
â”‚     - ê°€ì„¤ ê²€ì¦                                             â”‚
â”‚     - ì˜ˆìƒ vs ì‹¤ì œ ë¹„êµ                                     â”‚
â”‚     - ì•½ì  ì‹ë³„                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. ê°œì„  (Improve)                                          â”‚
â”‚     - ë°œê²¬ëœ ë¬¸ì œ ìˆ˜ì •                                      â”‚
â”‚     - Runbook ì—…ë°ì´íŠ¸                                      â”‚
â”‚     - ë°˜ë³µ                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. ì¥ì•  ì£¼ì… ë°©ë²•

### ë ˆë²¨ 1: ì¸í”„ë¼ ë ˆë²¨

```bash
# Pod ì‚­ì œ (ê°€ì¥ ê¸°ë³¸)
kubectl delete pod <pod-name> -n portal-universe

# Pod ê°•ì œ ì¢…ë£Œ
kubectl delete pod <pod-name> -n portal-universe --grace-period=0 --force

# ë…¸ë“œ drain (ìœ ì§€ë³´ìˆ˜ ì‹œë®¬ë ˆì´ì…˜)
kubectl drain <node-name> --ignore-daemonsets
```

### ë ˆë²¨ 2: ë¦¬ì†ŒìŠ¤ ë ˆë²¨

```bash
# ë©”ëª¨ë¦¬ ì œí•œ (OOM ì‹œë®¬ë ˆì´ì…˜)
kubectl patch deployment redis -n portal-universe -p \
  '{"spec":{"template":{"spec":{"containers":[{"name":"redis","resources":{"limits":{"memory":"64Mi"}}}]}}}}'

# CPU ì œí•œ
kubectl patch deployment api-gateway -n portal-universe -p \
  '{"spec":{"template":{"spec":{"containers":[{"name":"api-gateway","resources":{"limits":{"cpu":"100m"}}}]}}}}'
```

### ë ˆë²¨ 3: ë„¤íŠ¸ì›Œí¬ ë ˆë²¨

```bash
# Docker ì»¨í…Œì´ë„ˆì—ì„œ ë„¤íŠ¸ì›Œí¬ ì§€ì—° ì¶”ê°€
kubectl exec -it <pod-name> -n portal-universe -- \
  tc qdisc add dev eth0 root netem delay 100ms

# íŒ¨í‚· ì†ì‹¤ ì¶”ê°€
kubectl exec -it <pod-name> -n portal-universe -- \
  tc qdisc add dev eth0 root netem loss 10%
```

### ë ˆë²¨ 4: ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨

```java
// ì˜ë„ì  ì§€ì—° (í…ŒìŠ¤íŠ¸ìš©)
@GetMapping("/test-delay")
public ResponseEntity<String> testDelay() {
    Thread.sleep(5000);  // 5ì´ˆ ì§€ì—°
    return ResponseEntity.ok("delayed");
}

// ì˜ë„ì  ì—ëŸ¬
@GetMapping("/test-error")
public ResponseEntity<String> testError() {
    throw new RuntimeException("Chaos test error");
}
```

---

## 6. ì•ˆì „ ê°€ì´ë“œë¼ì¸

### DO (í•´ì•¼ í•  ê²ƒ)

- âœ… í•­ìƒ **ë¡¤ë°± ê³„íš** ì¤€ë¹„
- âœ… **ì˜í–¥ ë²”ìœ„ ì œí•œ** (1ê°œ Pod, 1ê°œ ì„œë¹„ìŠ¤)
- âœ… **ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§** ìœ ì§€
- âœ… **íŒ€ì›ì—ê²Œ ê³µìœ ** (Game Day)
- âœ… **ì ì§„ì  í™•ëŒ€** (ì‘ì€ ê²ƒë¶€í„°)

### DON'T (í•˜ì§€ ë§ ê²ƒ)

- âŒ í”„ë¡œë•ì…˜ì—ì„œ ì²« ì‹¤í—˜
- âŒ ë¹„ì¦ˆë‹ˆìŠ¤ í”¼í¬ ì‹œê°„ì— ì‹¤í—˜
- âŒ ëª¨ë‹ˆí„°ë§ ì—†ì´ ì‹¤í—˜
- âŒ ë¡¤ë°± ë°©ë²• ëª¨ë¥´ê³  ì‹¤í—˜
- âŒ ì „ì²´ ì‹œìŠ¤í…œì— ë™ì‹œ ì¥ì•  ì£¼ì…

### ë¹„ìƒ ì •ì§€ (Kill Switch)

```bash
# ì¦‰ì‹œ ë³µì› ìŠ¤í¬ë¦½íŠ¸
#!/bin/bash
# emergency-restore.sh

echo "=== ë¹„ìƒ ë³µì› ì‹œì‘ ==="

# Deployment ë³µì›
kubectl rollout undo deployment/api-gateway -n portal-universe
kubectl rollout undo deployment/auth-service -n portal-universe

# ë„¤íŠ¸ì›Œí¬ ì •ìƒí™”
kubectl exec -it <pod-name> -n portal-universe -- \
  tc qdisc del dev eth0 root || true

# ë¦¬ì†ŒìŠ¤ ì œí•œ ì›ë³µ
kubectl apply -f k8s/services/

echo "=== ë¹„ìƒ ë³µì› ì™„ë£Œ ==="
```

---

## 7. Portal Universe ì‹¤í—˜ ë¡œë“œë§µ

### Phase 3ì—ì„œ ë‹¤ë£° ì‹¤í—˜

| ì‹¤í—˜ | ë‚œì´ë„ | í•™ìŠµ |
|------|--------|------|
| Pod ì‚­ì œ | â­ | ê¸°ë³¸ Failover |
| ë©”ëª¨ë¦¬ ì œí•œ | â­â­ | OOM ë™ì‘ |
| ë„¤íŠ¸ì›Œí¬ ì§€ì—° | â­â­ | Timeout ë™ì‘ |
| Kafka ë¸Œë¡œì»¤ ë‹¤ìš´ | â­â­â­ | ì´ë²¤íŠ¸ ì˜í–¥ |
| Redis OOM | â­â­â­ | Rate Limiting ì˜í–¥ |
| ì—°ì‡„ ì¥ì•  | â­â­â­â­ | Circuit Breaker ë™ì‘ |

---

## í•µì‹¬ ì •ë¦¬

1. **Chaos Engineering**ì€ ì‹œìŠ¤í…œì˜ íšŒë³µë ¥ì— ëŒ€í•œ **í™•ì‹ **ì„ ì–»ëŠ” ë°©ë²•ì…ë‹ˆë‹¤
2. **ì •ìƒ ìƒíƒœ ê°€ì„¤**ì„ ë¨¼ì € ì •ì˜í•´ì•¼ í•©ë‹ˆë‹¤
3. **ì‹¤ì œ ë°œìƒ ê°€ëŠ¥í•œ** ì¥ì• ë¥¼ ì¬í˜„í•©ë‹ˆë‹¤
4. **ì˜í–¥ ë²”ìœ„ë¥¼ ì œí•œ**í•˜ê³  **ë¡¤ë°± ê³„íš**ì„ ì¤€ë¹„í•©ë‹ˆë‹¤
5. ì‹¤í—˜ í›„ **ê°œì„ **í•˜ê³  **ë°˜ë³µ**í•©ë‹ˆë‹¤

---

## ë‹¤ìŒ ë‹¨ê³„

[02-observability-setup.md](./02-observability-setup.md) - ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

---

## ì°¸ê³  ìë£Œ

- [Principles of Chaos Engineering](https://principlesofchaos.org/)
- [Netflix Chaos Monkey](https://netflix.github.io/chaosmonkey/)
- [Gremlin - Chaos Engineering Guide](https://www.gremlin.com/community/tutorials/chaos-engineering-the-history-principles-and-practice/)

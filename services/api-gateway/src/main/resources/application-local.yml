# ===================================================================
# API Gateway - Local Development Profile
# ===================================================================

server:
  forward-headers-strategy: framework

app:
  cors:
    allowed-origins:
      - http://localhost:30000
  frontend:
    base-url: http://localhost:30000
    host: localhost:30000
    scheme: http
    port: 30000

# 서비스 URL 정의 (IntelliJ 개발용 - localhost)
services:
  gateway:
    url: "http://localhost:8080"
  auth:
    url: "http://localhost:8081"
  blog:
    url: "http://localhost:8082"
  shopping:
    url: "http://localhost:8083"
  notification:
    url: "http://localhost:8084"
  prism:
    url: "http://localhost:8085"
  chatbot:
    url: "http://localhost:8086"

spring:
  kafka:
    bootstrap-servers: localhost:9092

  # Redis - Local Development
  data:
    redis:
      host: localhost
      port: 6379
      password:  # 로컬은 비밀번호 없음

# JWT secret은 Auth Service와 동일한 값을 환경 변수로 주입
# 기본값은 application.yml에 정의됨

# 로컬 환경에서는 HSTS 비활성화 (HTTP 사용)
security:
  headers:
    hsts:
      enabled: false

# Local Actuator 설정
management:
  endpoints:
    web:
      exposure:
        include: health,env,info,metrics,prometheus
      base-path: /actuator
  endpoint:
    health:
      show-details: always
  prometheus:
    metrics:
      export:
        enabled: true
  tracing:
    sampling:
      probability: 1.0
  zipkin:
    tracing:
      endpoint: http://localhost:9411/api/v2/spans
  metrics:
    tags:
      application: ${spring.application.name}
      environment: local

# 공개 경로 설정 (환경별 명시적 관리)
gateway:
  public-paths:
    permit-all:
      - "/notification/ws/**"
      - "/auth-service/**"
      - "/api/v1/auth/**"
      - "/api/v1/users/**"
      - "/api/v1/shopping/products"
      - "/api/v1/shopping/products/**"
      - "/api/v1/shopping/categories"
      - "/api/v1/shopping/categories/**"
      - "/api/v1/shopping/coupons"
      - "/api/v1/shopping/time-deals"
      - "/api/v1/shopping/time-deals/**"
      - "/api/v1/shopping/inventory/batch"
      - "/api/v1/shopping/inventory/stream"
      - "/api/v1/prism/health"
      - "/api/v1/prism/ready"
      - "/api/v1/chat/health"
      - "/api/health/**"
      - "/actuator/**"
      - "/api/v1/*/actuator/**"
    permit-all-get:
      - "/api/v1/blog/**"
      - "/api/v1/memberships/tiers/**"
      - "/api/v1/shopping/search/products"
      - "/api/v1/shopping/search/suggest"
      - "/api/v1/shopping/search/popular"
    skip-jwt-parsing:
      - "/auth-service/"
      - "/api/v1/auth/"
      - "/api/v1/users/"
      - "/api/health/"
      - "/actuator/"
      - "/api/v1/shopping/products"
      - "/api/v1/shopping/categories"
      - "/api/v1/prism/health"
      - "/api/v1/prism/ready"
      - "/api/v1/chat/health"

logging:
  level:
    root: INFO

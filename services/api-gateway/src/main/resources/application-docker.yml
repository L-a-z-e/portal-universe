# ===================================================================
# API Gateway - Docker Compose Profile
# ===================================================================

server:
  forward-headers-strategy: framework

app:
  cors:
    allowed-origins:
      - https://portal-universe:30000
  frontend:
    base-url: https://portal-shell:30000
    host: portal-universe:30000
    scheme: https
    port: 30000

# 서비스 URL 정의 (Docker DNS)
services:
  gateway:
    url: "http://api-gateway:8080"
  auth:
    url: "http://auth-service:8081"
  blog:
    url: "http://blog-service:8082"
  shopping:
    url: "http://shopping-service:8083"
  notification:
    url: "http://notification-service:8084"
  prism:
    url: "http://prism-service:8085"
  chatbot:
    url: "http://chatbot-service:8086"
  drive:
    url: "http://drive-service:8087"

spring:
  kafka:
    bootstrap-servers: kafka:29092

  # Redis - Docker Compose
  data:
    redis:
      host: redis
      port: 6379
      password: ${REDIS_PASSWORD:}

# JWT secret은 Auth Service와 동일한 값을 환경 변수로 주입
# Docker Compose에서 JWT_SECRET_KEY 환경 변수 설정 필요

# Docker 환경 모니터링 설정
management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus,metrics,env
      base-path: /actuator
  endpoint:
    health:
      show-details: always
      probes:
        enabled: true
  prometheus:
    metrics:
      export:
        enabled: true
  tracing:
    sampling:
      probability: 1.0
  zipkin:
    tracing:
      endpoint: http://zipkin:9411/api/v2/spans
  metrics:
    distribution:
      percentiles-histogram:
        http.server.requests: true
      slo:
        http.server.requests: 50ms,100ms,200ms,500ms,1s,5s
    tags:
      application: ${spring.application.name}
      environment: docker

# 공개 경로 설정 (환경별 명시적 관리)
gateway:
  public-paths:
    permit-all:
      - "/notification/ws/**"
      - "/auth-service/**"
      - "/api/v1/auth/**"
      - "/api/v1/users/**"
      - "/api/v1/shopping/products"
      - "/api/v1/shopping/products/**"
      - "/api/v1/shopping/categories"
      - "/api/v1/shopping/categories/**"
      - "/api/v1/shopping/coupons"
      - "/api/v1/shopping/time-deals"
      - "/api/v1/shopping/time-deals/**"
      - "/api/v1/shopping/inventory/batch"
      - "/api/v1/shopping/inventory/stream"
      - "/api/v1/prism/health"
      - "/api/v1/prism/ready"
      - "/api/v1/chat/health"
      - "/api/health/**"
      - "/actuator/**"
      - "/api/v1/*/actuator/**"
    permit-all-get:
      - "/api/v1/blog/**"
      - "/api/v1/memberships/tiers/**"
      - "/api/v1/shopping/search/products"
      - "/api/v1/shopping/search/suggest"
      - "/api/v1/shopping/search/popular"
    skip-jwt-parsing:
      - "/auth-service/"
      - "/api/v1/auth/"
      - "/api/v1/users/"
      - "/api/health/"
      - "/actuator/"
      - "/api/v1/shopping/products"
      - "/api/v1/shopping/categories"
      - "/api/v1/prism/health"
      - "/api/v1/prism/ready"
      - "/api/v1/chat/health"

logging:
  level:
    root: INFO
    com.portal.universe: INFO
    # 노이즈 억제
    io.netty: WARN
    reactor.netty: WARN
